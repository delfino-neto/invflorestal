<div class="taxonomy-list">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>
  
  <p-card>
    <ng-template pTemplate="header">
      <div class="p-4 card-header">
        <h2>
          <i class="material-symbols-outlined">potted_plant</i>
          Listagem de Espécies
        </h2>
        <button 
          pButton 
          type="button" 
          label="Nova Espécie" 
          icon="pi pi-plus"
          (click)="navigateToNew()">
        </button>
      </div>
    </ng-template>

    <!-- Filtros -->
    <div class="filters-container">
      <div class="filters-grid">
        <!-- Busca -->
        <div class="filter-field">
          <label for="search">Buscar</label>
          <p-iconfield>
            <p-inputicon styleClass="pi pi-search" />
            <input 
              class="w-full"
              id="search-species"
              name="search-species"
              type="text" 
              pInputText 
              [(ngModel)]="searchTerm"
              (ngModelChange)="onSearchChange()"
              placeholder="Nome científico, comum ou código..."
            />
          </p-iconfield>
        </div>

        <!-- Filtro por Família -->
        <div class="filter-field">
          <label for="family">Família</label>
          <p-select
            id="family"
            [(ngModel)]="selectedFamily"
            [options]="families"
            (onChange)="onFilterChange()"
            placeholder="Todas as famílias"
            [showClear]="true"
            styleClass="w-full"
          />
        </div>

        <!-- Filtro por Gênero -->
        <div class="filter-field">
          <label for="genus">Gênero</label>
          <p-select
            id="genus"
            [(ngModel)]="selectedGenus"
            [options]="genera"
            (onChange)="onFilterChange()"
            placeholder="Todos os gêneros"
            [showClear]="true"
            styleClass="w-full"
          />
        </div>

        <!-- Botão Limpar -->
        <div class="filter-field filter-actions">
          <label>&nbsp;</label>
          <button 
            pButton 
            type="button" 
            label="Limpar Filtros" 
            icon="pi pi-filter-slash"
            class="p-button-outlined"
            (click)="clearFilters()"
            [disabled]="!searchTerm && !selectedFamily && !selectedGenus">
          </button>
        </div>
      </div>

      <!-- Feedback de filtros ativos -->
      <div class="active-filters" *ngIf="hasActiveFilters()">
        <div class="filters-info">
          <i class="pi pi-filter"></i>
          <span>Filtros ativos:</span>
          
          <div class="filter-chips">
            <p-chip 
              *ngIf="searchTerm" 
              [label]="'Busca: &quot;' + searchTerm + '&quot;'"
              [removable]="true"
              (onRemove)="clearSearch()"
              styleClass="filter-chip search-chip">
            </p-chip>
            
            <p-chip 
              *ngIf="selectedFamily" 
              [label]="'Família: ' + selectedFamily"
              [removable]="true"
              (onRemove)="clearFamily()"
              styleClass="filter-chip family-chip">
            </p-chip>
            
            <p-chip 
              *ngIf="selectedGenus" 
              [label]="'Gênero: ' + selectedGenus"
              [removable]="true"
              (onRemove)="clearGenus()"
              styleClass="filter-chip genus-chip">
            </p-chip>
          </div>
          
          <span class="results-count">{{ totalRecords }} resultado(s)</span>
        </div>
      </div>
    </div>

    <!-- Barra de progresso -->
    <div class="loading-bar" *ngIf="loading">
      <p-progressbar mode="indeterminate" [style]="{'height': '4px'}"></p-progressbar>
    </div>

    <p-table 
      [value]="taxonomies" 
      [loading]="loading"
      [paginator]="true" 
      [rows]="10"
      [totalRecords]="totalRecords"
      [lazy]="true"
      (onLazyLoad)="loadTaxonomies($event)"
      styleClass="p-datatable-striped">
      
      <ng-template pTemplate="header">
        <tr>
          <th>Nome Científico</th>
          <th>Nome Comum</th>
          <th>Família</th>
          <th>Gênero</th>
          <th>Código</th>
          <th style="width: 120px">Ações</th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-taxonomy>
        <tr>
          <td><strong>{{ taxonomy.scientificName }}</strong></td>
          <td>{{ taxonomy.commonName || '-' }}</td>
          <td>
            <p-tag 
              *ngIf="taxonomy.family" 
              [value]="taxonomy.family"
              severity="info">
            </p-tag>
            <span *ngIf="!taxonomy.family">-</span>
          </td>
          <td>{{ taxonomy.genus || '-' }}</td>
          <td>
            <code *ngIf="taxonomy.code">{{ taxonomy.code }}</code>
            <span *ngIf="!taxonomy.code">-</span>
          </td>
          <td>
            <div class="action-buttons">
              <button 
                pButton 
                type="button"
                icon="pi pi-pencil"
                class="p-button-text p-button-sm"
                pTooltip="Editar"
                (click)="navigateToEdit(taxonomy.id!)">
              </button>
              <button 
                pButton 
                type="button"
                icon="pi pi-trash"
                class="p-button-text p-button-sm p-button-danger"
                pTooltip="Excluir"
                (click)="confirmDelete(taxonomy)">
              </button>
            </div>
          </td>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center">
            <div class="empty-state">
              <i class="pi pi-search" style="font-size: 3rem; color: var(--text-color-secondary);"></i>
              <p>Nenhuma espécie encontrada</p>
              <button 
                pButton 
                type="button" 
                label="Criar primeira espécie" 
                icon="pi pi-plus"
                class="p-button-outlined"
                (click)="navigateToNew()">
              </button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>
